{% extends 'MenuModule/base.html' %} {% block content %}

<body>
    <!-- <div id="dynamic_menu">

    </div> -->
    <br>

<div class="container">
    <div class="content section col-lg-7 col-md-7" id="main">

    </div>
    <div class='content section'>
        <h1 id="total_price" class="" style="padding-top:150px;"></h1>
        <table class="table table-sm" id="name">
            <tr>
                <th class="text-white text-left">Name</th>
                <th class="text-white text-right">Price</th>
            </tr>
        </table>
    
    </div>
   
    <button type="button" class="btn btn-primary">
        Order
    </button>
</div>

    <script>
        $(document).ready(function() {
            create_menu()
        });

        total_price = 0
        ordered_item = {
            'name': [],
            'price': [],
        }
        order_item_id = 0

        function add(name, price) {
            ordered_item['name'].push(name);
            ordered_item['price'].push(price);
            order_item_id += 1
            total_price += parseInt(price)
            $("#name").append(
                '<tr scope="row" class="list-group-item-action text-left" onclick="remove(' + order_item_id + ','+ "'" + name +"'" +')" id = "' + order_item_id + '" ><td>' + name + '</td><td style="width: 10px;" class="text-right">Rs.' + price + '</td></tr>'
            );
            document.getElementById("total_price").innerHTML = total_price;
        }

        function remove(order_item_id, name ) {
            $("#" + order_item_id).remove();
            price = 0
            for(var i=0; i<(ordered_item['name'].length); i++)
            {
                if(name == (ordered_item['name'][i]))
                {
                    price = ordered_item['price'][i];
                    ordered_item['name'].splice(i,1);
                    ordered_item['price'].splice(i,1);
                    break
                }
            };
            total_price = total_price - price           
            document.getElementById("total_price").innerHTML = total_price;
        }

        function sendOrder() {
            $.ajax({
                type: 'POST',
                url: '',
                data: JSON.stringify(ordered_item),
                success: function(data) {
                    if(!alert('Your Order has been place and will get to you shortly. Thank you!')){window.location.reload();}
                }
            })
        }

        function create_menu() {
            data = {{ data | safe }}
            outputData(data)
            // $.ajax({
            //     type: 'POST',
            //     url: '/menu',
            //     data: JSON.stringify(),
            //     success: function(data) {
            //         outputData(data);
            //     },
            //     error: function(data) {    
            //         //error popup
            //     }
            // })

        }

        function outputData(data) {
            for (var food_type in data) {
                $("#dynamic_menu").append(
                    "<li><a href='#" + food_type + "'  class='js-scroll-trigger'>" + food_type + "</a></li>"
                )
                $("#main").append(
                    "<section id='" + food_type + "'><table class='table table-sm'><tbody id='food_data_" + food_type + "'><tr><th class='' colspan='2'>" + food_type + "</th></tr></tbody></table><br><br></section>"
                );
                for (i = 0; i < data[food_type].name.length; i++) {
                    $('#food_data_' + food_type).append(
                        "<tr class='list-group-item-action text-left' scope='row' onclick='add(" + '"' + data[food_type].name[i] + '"' + "," + '"' + data[food_type].price[i] + '"' +")'><td>" + data[food_type].name[i] + "</td><td class='text-right'>Rs." + data[food_type].price[i] + "</td></tr>"
                    )
                }
            }
        }

        function popup(){

        }
    </script>
</body>
{% endblock %}